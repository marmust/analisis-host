<!DOCTYPE html>
<html>
  <link rel="stylesheet" href="style.css">

  <head>
    <title>ANALISIS</title>
    <img src="https://cdn.discordapp.com/attachments/990898405310074892/1103790726321537135/analisis_logo_3.png" alt="ANALISIS logo">
    <br>
    <h1>DEAL WITH TRAUMA INJURIES</h1>
  </head>

  <body>
    <div class="container">
      <div class="video-container">
        <video id="video"></video>
      </div>
      <div class="input-container">
        <textarea id="text-input" placeholder="HOW DID THIS HAPPEN:"></textarea>
        <br>
        <input type="range" min="0" max="10" value="5" id="slider">
        <br>
        <button onclick="sendData()">RUN DIAGNOSIS</button>
        <br>
        <p id="result" class="instruction-text"></p>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function(stream) {
          var video = document.getElementById("video");
          video.srcObject = stream;
          video.play();
        })
        .catch(function(error) {
          console.error(error);
        });

      function sendData() {
        var video = document.getElementById("video");
        var canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        var imageData = canvas.toDataURL('image/jpeg');
        var textInput = document.getElementById("text-input").value;
        var sliderValue = document.getElementById("slider").value;
        console.log(imageData);
        console.log(sliderValue);
        console.log(textInput);
        $.ajax({
          url: 'http://44.198.240.54:8000/pass_to_backend',
          type: 'POST',
          data: JSON.stringify({ image: imageData, text: textInput, sliderValue: sliderValue }),
          contentType: 'application/json',
          success: function(response) {
            console.log(response);
            document.getElementById("result").innerHTML = response;
          },
          error: function(error) {
            console.error(error);
          }
        });
      }
    </script>
  </body>
</html>